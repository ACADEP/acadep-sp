<header class="main-heading shadow-2dp">
  <!-- begin dashhead -->
  <div class="dashhead bg-white">
    <div class="dashhead-titles">
      <h6 class="dashhead-subtitle" style="margin-top:10px">
        Inicio / Evidencia
      </h6>

      <!-- <h3 class="dashhead-title" #content>Evidencia</h3> -->

    </div>

    <!-- <div class="dashhead-toolbar">
      <div class="dashhead-toolbar-item">
        <a>App</a>
        / Evidencia
      </div>
    </div> -->
  </div>
  <!-- END: dashhead -->
</header>
<!-- END: .main-heading -->

<!-- begin .main-content -->
<div class="main-content bg-clouds">

  <!-- begin .container-fluid -->
  <div class="container-fluid p-t-15">
    <div class="row">


      <div class="col-md-12">
        <div class="box">
          <!-- <h2 class="text-center">hola</h2> -->
          <form action="">

            <form style="margin-top:10px; margin-left:15px">
              <div class="row">

                <div class="col-md-3">
                  <div class="form-group">
                    <!-- <label for="itext">Buscar Proyecto</label> -->
                    <div class="icon-after-input">
                      <input type="text" class="form-control input-sm p-r-80" id="atext3" name="search" placeholder="Buscar...">
                      <div class="icon">
                        <button class="btn btn-info btn-sm btn-rect" style="background: #337ab7; border: #337ab7" type="button"><i
                            class="fa fa-search fa-lg"></i></button>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-md-2">
                  <div class="form-group">
                    <!-- <label id="labeltype">Proyecto<span class="required">*</span></label> -->
                    <select id="type" class="form-control" [(ngModel)]="idEvent" name="idevent" (change)="UpdateEvidence()">
                      <option value="">Todos los eventos</option>

                      <option [value]="event.id" *ngFor="let event of eventsCollection">{{event.title}}</option>
                      <!-- <option *ngFor='let item of types' [ngValue]="item">{{item}}</option> -->
                    </select>
                  </div>
                </div>
                <div class="col-md-2">
                  <div class="form-group">
                    <!-- <label id="labeltype">Proyecto<span class="required">*</span></label> -->
                    <select id="type" class="form-control" [(ngModel)]="idUser" name="iduser" (change)="UpdateEvidence()">
                      <option value="">Todos los usuarios</option>
                      <option [value]="user.id" *ngFor="let user of usersCollection">{{user.name}}</option>

                      <!-- <option *ngFor='let item of types' [ngValue]="item">{{item}}</option> -->
                    </select>
                  </div>
                </div>

                <div class="col-md-4">
                  

                </div>


              </div>
            </form>



          </form>
        </div>
      </div>


      <div class="col-md-12" >
        <!-- BEGIN: clave.js -->
        <div class="row">
          <div class="col-xs-12">
            <div class="box">
              <header>
                <h3>Resultados de la búsqueda</h3>
                <div class="box-tools">
                  <i style="color:rgb(129, 120, 120); " id="btncolapse" class="pointer fa fa-plus-circle fa-2x" (click)="openAll()"></i>
                  <i style="color:rgb(129, 120, 120); margin-left:11px" class="pointer fa fa-minus-circle fa-2x"
                    (click)="closeAll()"></i>
                </div>
              </header>



              <mat-spinner *ngIf="loading"></mat-spinner>

              <div style="height:800px; overflow-y: scroll;" >
                  <mat-accordion   class="example-headers-align" #myaccordion="matAccordion" multi="true">

                      <mat-expansion-panel [ngClass]="{'read': !evidence.read}"  [expanded]="indexExpanded == i"  *ngFor="let evidence of evidenceCollection; index as i" (click)="readEvidence(evidence, i)">
                        <mat-expansion-panel-header>
                          <mat-panel-title>
                            <mat-checkbox (click)="$event.stopPropagation();" color="primary"></mat-checkbox>&nbsp;
                            {{evidence.ref_event.name.substring(0,75)}}
                            <!-- <h4> </h4>  -->
                          </mat-panel-title>
                          <mat-panel-description>
      
                            <span *ngIf="evidence.total">
                              {{evidence.advanced}} / {{evidence.total.number}}&nbsp;{{evidence.total.unit}}
                            </span>


                            <span>Etapa: {{getEtapa(evidence.header)}}</span>
                            <span>Asignado a: {{evidence.user.name}}</span>
                            <!-- <span>{{evidence.created_at | date:'dd/MM/y'}} {{evidence.created_at |date:'shortTime'}}</span> -->

                            <mat-icon style="color:#f44336" class="delete" (click)="$event.stopPropagation(); export(evidence, $event)">picture_as_pdf</mat-icon>
      
      
                          </mat-panel-description>
                        </mat-expansion-panel-header>
                        <div class="row">
                          <div class="col-md-9">
                            <div class="col-md-12">
                              <h4>Descripción</h4>
                              <p style="padding:20px">{{evidence.description}}</p>
                            <!-- <button mat-raised-button color="warn" (click)="">Exportar a PDF</button> -->
      
                            </div>
                            <div class="col-md-12">
                              <h4>Imágenes</h4>
                              <div>
                                <div class="row">
                                  <div class="col-md-2 col-sm-4 col-xs-6" *ngFor="let item of evidence.multimedia; index as a">
                                    <img class="galery" id="img{{i}}{{a}}" src="{{item.src}}" style="border: #ccc 1px solid" (click)="showImage(evidence, a)">
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                          <div class="col-md-3" style="border:#ddd 1px solid; padding: 10px">
                            <h4>Documentos</h4>
                            <div *ngIf="evidence.files.length; else no_files">
                              <div *ngFor="let item of evidence.files">
                                <a target="_blank" [href]="item.src" [download]="item.name"><i [ngClass]="getClass(item.type)"
                                    [style.color]="getColor(item.type)"></i>
                                  {{item.name}} </a>
                              </div>
                              <br>
                            </div>
                            <ng-template #no_files>
                              <p><i>Ningún archivo adjunto</i></p>
                            </ng-template>
                          </div>
                        </div>
                      </mat-expansion-panel>
                    </mat-accordion>
              </div>
             
            </div>
          </div>
        </div>
        <!-- END: clave.js -->
      </div>

      <!-- <div class="col-md-4">
          <div class="row">
            <div class="col-xs-12">
              <div class="box">
                <header class="bg-asbestos text-white">
                  <h4>Crear nuevo evento</h4>
                </header>
                <div class="box-body collapse in">
                 
                </div>
              </div>
            </div>
          </div>
        </div> -->
    </div>
  </div>
  <!-- END: .container-fluid -->

</div>
<!-- END: .main-content -->


<!-- Modal para ver imagenes -->
<div class="modal fade" id="showimage" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <!-- <h5 class="modal-title" id="exampleModalLongTitle">Modal title</h5> -->
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <img class="center" [src]="image.src" alt="">
        <hr>
        Ubicación: <br>


        <agm-map [zoom]="17" [latitude]="image.ubication.lat" [longitude]="image.ubication.lng">
            <agm-marker 
            [latitude]="image.ubication.lat" 
            [longitude]="image.ubication.lng" 
            [markerDraggable]="false"
            ></agm-marker>
          </agm-map> 

        <!-- latitud:{{image.ubication.lat}} <br>
        longitud: {{image.ubication.lng}} -->
      </div>

    </div>
  </div>
</div>


<div class="hidden" id="content" #content>
  <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Vel ipsa sit, sunt quasi aspernatur assumenda magnam ex
    ipsum odit laboriosam, laborum id tempora perspiciatis veritatis illo dignissimos ab natus placeat?</p>

<img id src="" alt="">

</div>
